# Migraci√≥n CSS - Limpieza de IDs y Preparaci√≥n para Estabilizaci√≥n

## üìÖ Fecha: 31 Octubre 2025

## ‚úÖ Cambios Realizados

### 1. Migraci√≥n de IDs a `data-js` Attributes

#### **Problema**

Los selectores `#id` en CSS tienen alta especificidad y no deben usarse para estilos.  
Sin embargo, varios componentes usaban IDs tanto para JavaScript como para CSS.

#### **Soluci√≥n**

Separar concerns: usar `data-js="*"` para JavaScript y mantener solo clases para estilos.

#### **Cambios Implementados**

| Componente           | Antes                     | Despu√©s                        | Archivo                |
| -------------------- | ------------------------- | ------------------------------ | ---------------------- |
| **Navigation**       | `id="cs-navigation"`      | `data-js="navigation"`         | `Header.astro`         |
| **Mobile Toggle**    | `id="mobile-menu-toggle"` | `data-js="mobile-menu-toggle"` | `Header.astro`         |
| **Dark Mode Toggle** | `id="dark-mode-toggle"`   | `data-js="dark-mode-toggle"`   | `DarkModeToggle.astro` |
| **Footer**           | `id="footer"`             | _(eliminado, no usa JS)_       | `Footer.astro`         |

#### **Archivos JavaScript Actualizados**

**`src/js/nav.js`:**

```javascript
// Antes
const CSnavbarMenu = document.getElementById('cs-navigation');
const mobileMenuToggle = document.getElementById('mobile-menu-toggle');

// Despu√©s
const CSnavbarMenu = document.querySelector('[data-js="navigation"]');
const mobileMenuToggle = document.querySelector(
  '[data-js="mobile-menu-toggle"]'
);
```

**`src/components/DarkModeToggle.astro`:**

```javascript
// Antes
const darkModeToggleButton = document.getElementById('dark-mode-toggle');

// Despu√©s
const darkModeToggleButton = document.querySelector(
  '[data-js="dark-mode-toggle"]'
);
```

---

### 2. Eliminaci√≥n de Alias de IDs en Legacy

#### **Archivos Modificados**

**`src/styles/legacy/_id-aliases.less`:**

**Eliminado:**

- `#cs-navigation { }` - ‚úÖ Ya no necesario, JS usa `data-js`
- `#dark-mode-toggle { }` - ‚úÖ Ya no necesario, JS usa `data-js`
- `#footer { }` - ‚úÖ Ya no necesario, sin dependencias JS
- `#news-content { }` - ‚úÖ Ya no necesario, estilos en `.news-content`

**Mantenido (temporal):**

- Aliases `:where(.cs-*)` - Mantener hasta migraci√≥n completa de HTML
- IDs de secciones de p√°gina (#hero, #services, etc.) - Pendiente migraci√≥n futura

---

### 3. Stylelint Activado en Modo Error

#### **Configuraci√≥n Actualizada**

**Archivo:** `.stylelintrc.json`

**Cambios:**

```json
{
  "defaultSeverity": "error", // ‚Üê Antes: "warning"
  "rules": {
    "selector-max-id": 0, // No IDs permitidos (error)
    "max-nesting-depth": [
      3,
      {
        "ignore": ["blockless-at-rules", "pseudo-classes"]
      }
    ],
    "block-no-empty": [
      true,
      {
        "severity": "warning" // Rulesets vac√≠os = warning (no error)
      }
    ],
    "selector-class-pattern": [
      "^([a-z0-9]+(?:-[a-z0-9]+)*)?(?:__(?:[a-z0-9]+(?:-[a-z0-9]+)*))?(?:--[a-z0-9]+(?:-[a-z0-9]+)*)?$|^u-[a-z0-9-]+$",
      {
        "message": "Usa BEM ligero: bloque, __elemento, --modificador, o utilidades u-*",
        "severity": "error"
      }
    ]
  },
  "ignoreFiles": [
    // ... existing
    "**/legacy/_id-aliases.less" // Ignorar aliases temporales
  ]
}
```

**Beneficios:**

- ‚úÖ Bloquea PRs con nuevos IDs en CSS
- ‚úÖ Fuerza nomenclatura BEM consistente
- ‚úÖ Permite alias temporales en `_id-aliases.less` (excluido)
- ‚úÖ Mantiene 3 niveles m√°x de anidaci√≥n

---

## üìä Impacto

### Archivos Modificados (6 total)

1. ‚úÖ `src/components/Header.astro`
2. ‚úÖ `src/components/DarkModeToggle.astro`
3. ‚úÖ `src/components/Footer.astro`
4. ‚úÖ `src/js/nav.js`
5. ‚úÖ `src/styles/legacy/_id-aliases.less`
6. ‚úÖ `.stylelintrc.json`

### L√≠neas de C√≥digo Afectadas

- **HTML/Astro:** ~10 l√≠neas (IDs eliminados/cambiados)
- **JavaScript:** 4 l√≠neas (querySelector reemplazos)
- **CSS:** ~80 l√≠neas (aliases eliminados)
- **Config:** 15 l√≠neas (Stylelint actualizado)

---

## üöÄ Pr√≥ximos Pasos (Fuera de este PR)

### Fase 1: Migraci√≥n de Clases `.cs-*` ‚Üí `.c-*` (Futuro)

**Estado:** ‚è∏Ô∏è PENDIENTE (no en este PR)

**Alcance:** 50+ ocurrencias en archivos `.astro`

**Plan:**

1. Crear script de migraci√≥n autom√°tica
2. Reemplazar todas las `class="cs-*"` por `class="c-*"`
3. Eliminar aliases `:where(.cs-*)` de `_id-aliases.less`
4. Ejecutar `purge:dry` para validar
5. Testing visual completo

**Archivos afectados:**

- `src/pages/index.astro` - ~40 ocurrencias
- `src/pages/sobre-el-pueblo.astro` - ~10 ocurrencias
- `src/pages/contacto.astro` - ~5 ocurrencias
- `src/components/FAQ.astro` - ~5 ocurrencias
- Otros layouts y componentes

**Riesgo:** MEDIO - Requiere testing visual exhaustivo

---

### Fase 2: Migraci√≥n de Page Sections (Futuro)

**Estado:** ‚è∏Ô∏è PENDIENTE

**IDs a Migrar:**

- `#hero` ‚Üí `.hero` o `.c-hero`
- `#services` ‚Üí `.c-services`
- `#sbs` ‚Üí `.c-side-by-side`
- `#sbs-r` ‚Üí `.c-side-by-side--reverse`
- `#gallery` ‚Üí `.c-gallery`
- `#reviews` ‚Üí `.c-reviews`
- `#cs-contact` ‚Üí `.c-contact`

**Plan:**

1. Crear componentes en `@layer components`
2. Aplicar clases en HTML
3. Eliminar IDs de CSS
4. Testing

**Riesgo:** BAJO - No usan JavaScript

---

### Fase 3: Purga Completa de Legacy (Futuro)

**Estado:** ‚è∏Ô∏è PENDIENTE hasta Fase 1 y 2 completas

**Objetivo:** Eliminar completamente `@layer legacy`

**Pre-requisitos:**

- ‚úÖ Todos los IDs migrados
- ‚úÖ Todos los `.cs-*` migrados a `.c-*`
- ‚úÖ Testing visual completo
- ‚úÖ An√°lisis con `purge:dry` exitoso

**Beneficios esperados:**

- Reducci√≥n ~40-50% de tama√±o CSS total
- Arquitectura ITCSS pura
- Cero deuda t√©cnica CSS

---

## üìã Convenciones Establecidas

### Regla 1: IDs Solo para Accesibilidad o Hooks JS

**Uso permitido de `id`:**

```html
<!-- ‚úÖ Accesibilidad (label for) -->
<label for="email">Email</label>
<input type="email" id="email" name="email" />

<!-- ‚ùå NO usar para CSS -->
<div id="header">
  <!-- MAL -->

  <!-- ‚úÖ Usar data-js para JavaScript -->
  <button data-js="mobile-toggle" class="c-toggle"></button>
</div>
```

**Selectores JavaScript:**

```javascript
// ‚úÖ BIEN - data attributes
document.querySelector('[data-js="toggle"]');

// ‚ùå MAL - IDs
document.getElementById('toggle');
```

---

### Regla 2: Nomenclatura BEM Ligera

**Patr√≥n:**

```
.bloque
.bloque__elemento
.bloque--modificador
.bloque__elemento--modificador
```

**Ejemplos:**

```less
.c-card {
} // Componente
.c-card__title {
} // Elemento
.c-card--featured {
} // Modificador
.c-card__title--large {
} // Elemento con modificador

.u-mt-md {
} // Utilidad
```

---

### Regla 3: Utilidades vs Componentes

**Cu√°ndo usar utilidades:**

- Spacing puntual (1-2 propiedades)
- Alineaciones simples
- Display helpers

**Cu√°ndo crear componente:**

- 3+ utilidades juntas permanentemente
- L√≥gica de layout compleja
- Reutilizable en m√∫ltiples lugares

**Ejemplo:**

```html
<!-- ‚úÖ BIEN: Spacing puntual -->
<article class="c-card u-mt-lg">
  <!-- ‚ùå MAL: 5+ utilidades permanentes -->
  <div class="u-flex u-items-center u-justify-between u-p-md u-bg-primary">
    <!-- Crear .c-header-bar en su lugar -->
  </div>
</article>
```

---

## üéØ M√©tricas de Calidad

### Antes de esta Migraci√≥n

- IDs en CSS: ~10 selectores
- Especificidad promedio: 1,0,2 (alta)
- Stylelint: Modo warning (no bloquea)
- Legacy aliases: 80+ reglas vac√≠as

### Despu√©s de esta Migraci√≥n

- IDs en CSS: 0 (‚úÖ eliminados los migrados)
- Especificidad promedio: 0,1,0 (media)
- Stylelint: Modo error (bloquea PRs)
- Legacy aliases: ~50 (solo `.cs-*` temporales)

### Objetivo Final (Post Fase 1-3)

- IDs en CSS: 0
- Especificidad promedio: 0,1,0
- Stylelint: Modo error activo
- Legacy aliases: 0
- `@layer legacy`: Eliminada completamente

---

## ‚úÖ Checklist de Verificaci√≥n

### Funcionalidad

- [x] Navigation hamburger toggle funciona
- [x] Dark mode toggle funciona
- [x] Navegaci√≥n desktop funciona
- [x] Dropdowns de navegaci√≥n funcionan
- [x] Footer se visualiza correctamente

### Compatibilidad

- [x] JavaScript usa `data-js` attributes
- [x] Stylelint no bloquea c√≥digo v√°lido
- [x] Legacy aliases mantienen compatibilidad temporal
- [x] View Transitions no se rompen

### Calidad

- [x] Sin IDs en CSS (excluidos los pendientes)
- [x] Nomenclatura BEM consistente
- [x] M√°x 3 niveles de anidaci√≥n
- [x] Documentaci√≥n actualizada

---

## üìö Documentaci√≥n Relacionada

- üìò [LEGACY_CLEANUP_ROADMAP.md](./LEGACY_CLEANUP_ROADMAP.md) - Plan futuro de limpieza
- üìó [WHERE_MIGRATION_COMPLETE.md](./WHERE_MIGRATION_COMPLETE.md) - Migraci√≥n `:where()`
- üìï [CSS_OPTIMIZATION.md](./CSS_OPTIMIZATION.md) - Optimizaci√≥n y purgado
- üìô [README.md](../README.md) - Documentaci√≥n principal

---

## üéì Lecciones Aprendidas

### 1. Separar Concerns (CSS vs JS)

**Antes:** `id="header"` usado para CSS y JS  
**Despu√©s:** `class="c-header"` (CSS) + `data-js="navigation"` (JS)

**Beneficio:** Refactors de CSS no rompen JavaScript

---

### 2. Migraci√≥n Progresiva

**No intentar:** Migrar todo en un solo PR  
**Mejor:** Fases iterativas con testing

**Beneficio:** Menor riesgo, m√°s f√°cil de revertir

---

### 3. Aliases Temporales con `:where()`

**T√©cnica:** Usar `:where(.old-class)` con especificidad 0  
**Beneficio:** Compatibilidad sin interferir con nuevas clases

---

**√öltima actualizaci√≥n:** 31 Octubre 2025  
**Estado:** ‚úÖ Fase de IDs Completada  
**Siguiente:** Migraci√≥n .cs-_ ‚Üí .c-_ (Futuro PR)
