---
import BaseLayout from '@layouts/BaseLayout.astro';
import contactInfo from '@js/contact';
import Landing from '@components/sections/Landing.astro';
import Button from '@components/ui/Button.astro';

// Optimize our landing image and pass it as props to the BaseLayout (for preloading) and Landing (for rendering)
import landingImage from '@assets/images/vista-aerea-2.jpg'; // <-- THE PATH TO THE ASSET YOU WANT TO PRELOAD - The asset must live in src
import { getImage } from 'astro:assets';
const optimizedImage = await getImage({ src: landingImage, format: 'avif' });
const contactPageTitle = `Contacto - ${contactInfo.entity.name}`;
const contactPageDescription = `Ponte en contacto con el ${contactInfo.entity.name}. Información de contacto actualizada, direcciones y formulario para consultas ciudadanas.`;
const phones = contactInfo.contact?.phones ?? [];
const emails = contactInfo.contact?.emails ?? [];
const offices = (contactInfo.offices ?? []).map(office => ({
  ...office,
  lines: [
    office.street,
    [office.locality, office.region].filter(Boolean).join(', '),
    office.postalCode,
  ].filter(Boolean),
}));
---

<BaseLayout
  title={contactPageTitle}
  description={contactPageDescription}
  preloadedImage={optimizedImage}
>
  <!-- ============================================ -->
  <!--                    LANDING                   -->
  <!-- ============================================ -->

  <Landing title="Contacto" image={optimizedImage}>
    <p>
      Ponte en contacto con el {contactInfo.entity.name} para consultas, sugerencias
      y trámites municipales.
    </p>
  </Landing>

  <!-- ============================================ -->
  <!--                Contact Form                  -->
  <!-- ============================================ -->

  <section id="cs-contact">
    <div class="cs-container">
      <form id="cs-form" name="Contact Form" method="post">
        <div class="cs-content">
          <span class="cs-topper">Contacto</span>
          <h2 class="cs-title">
            Ponte en contacto con el {contactInfo.entity.name}
          </h2>
          <p class="cs-text">
            El {contactInfo.entity.name} está aquí para atender tus consultas, sugerencias
            y trámites administrativos. No dudes en contactarnos para cualquier asunto
            relacionado con nuestro municipio. Estaremos encantados de ayudarte.
          </p>
        </div>
        <label>
          Nombre
          <input
            required
            type="text"
            id="name"
            name="name"
            placeholder="Nombre completo"
          />
        </label>
        <label>
          Correo electrónico
          <input
            required
            type="email"
            id="email"
            name="email"
            placeholder="tu@email.com"
          />
        </label>
        <label>
          Teléfono
          <input
            required
            type="tel"
            id="phone"
            name="phone"
            placeholder="Número de teléfono"
          />
        </label>
        <label>
          Asunto
          <input
            type="text"
            id="find"
            name="subject"
            placeholder="Motivo de la consulta"
          />
        </label>
        <label class="cs-label-message">
          Mensaje
          <textarea
            required
            name="Message"
            id="message"
            placeholder="Escribe tu mensaje aquí..."></textarea>
        </label>
        <Button type="submit">Enviar mensaje</Button>
      </form>
      <div class="cs-right-section">
        {
          emails.map(email => (
            <>
              <span class="cs-header">{email.label}</span>
              <a class="cs-link" href={`mailto:${email.address}`}>
                {email.address}
              </a>
            </>
          ))
        }
        {
          phones.map(phone => (
            <>
              <span class="cs-header">{phone.label}</span>
              <a class="cs-link" href={`tel:${phone.href}`}>
                {phone.display}
              </a>
            </>
          ))
        }
        {
          offices.map(office => (
            <>
              <span class="cs-header">{office.label}</span>
              {office.mapsUrl ? (
                <a class="cs-link" href={office.mapsUrl}>
                  {office.lines.map((line, index) => {
                    const isLastLine = index === office.lines.length - 1;

                    return (
                      <>
                        <span class={isLastLine ? 'cs-block' : undefined}>
                          {line}
                        </span>
                        {!isLastLine && <br />}
                      </>
                    );
                  })}
                </a>
              ) : (
                <span class="cs-link">
                  {office.lines.map((line, index) => {
                    const isLastLine = index === office.lines.length - 1;

                    return (
                      <>
                        <span class={isLastLine ? 'cs-block' : undefined}>
                          {line}
                        </span>
                        {!isLastLine && <br />}
                      </>
                    );
                  })}
                </span>
              )}
            </>
          ))
        }

        <!-- Background Image-->
        <picture class="cs-bg-picture">
          <source
            media="(min-width: 601px)"
            srcset="/assets/images/skyscraper.jpg"
          />
          <img
            aria-hidden="true"
            decoding="async"
            src="/assets/images/skyscraper.jpg"
            alt="building"
            loading="lazy"
            width="2500"
            height="1667"
          />
        </picture>
      </div>
    </div>
  </section>
</BaseLayout>

<style lang="less">
  @import '../styles/pages/contacto.less';
</style>
