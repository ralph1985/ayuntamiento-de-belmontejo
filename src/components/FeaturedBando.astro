---
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';
import { formatDate } from '@js/utils';
import '@styles/sidebar.less';

interface Props {
  excludeCurrentPost?: string;
}

const { excludeCurrentPost } = Astro.props;

const posts = await getCollection('bandos');
const featuredBandos = posts
  .filter(post => post.data.isFeatured === true)
  .filter(post => (excludeCurrentPost ? post.id !== excludeCurrentPost : true));
---

<h3 class="news-sidebar_widget-header">Bandos Destacados</h3>
{
  featuredBandos.length === 0 && (
    <p class="no-featured-message">No hay bandos destacados disponibles.</p>
  )
}
{
  featuredBandos.map(post => (
    <a class="news-sidebar_widget-link" href={`/bandos/${post.id}`}>
      {post.data.image ? (
        <picture class="news-sidebar_widget-image">
          <Image
            src={post.data.image}
            alt={post.data.imageAlt || post.data.title}
            width="60"
            height="60"
            decoding="async"
          />
        </picture>
      ) : (
        <div class="news-sidebar_widget-image news-sidebar_widget-image--placeholder">
          <svg
            width="60"
            height="60"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M14 2H6C5.46957 2 4.96086 2.21071 4.58579 2.58579C4.21071 2.96086 4 3.46957 4 4V20C4 20.5304 4.21071 21.0391 4.58579 21.4142C4.96086 21.7893 5.46957 22 6 22H18C18.5304 22 19.0391 21.7893 19.4142 21.4142C19.7893 21.0391 20 20.5304 20 20V8L14 2Z"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <polyline
              points="14,2 14,8 20,8"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <line
              x1="16"
              y1="13"
              x2="8"
              y2="13"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <line
              x1="16"
              y1="17"
              x2="8"
              y2="17"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
            <polyline
              points="10,9 9,9 8,9"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            />
          </svg>
        </div>
      )}
      <div class="content-group">
        <h4 class="news-sidebar_widget-h4">{post.data.title}</h4>
        <span class="news-sidebar_widget-date">
          {formatDate(post.data.date)}
        </span>
        {post.data.category && (
          <span class="news-sidebar_widget-category">{post.data.category}</span>
        )}
      </div>
    </a>
  ))
}

<style>
  .no-featured-message {
    color: #6b7280;
    font-style: italic;
    font-size: 0.875rem;
    text-align: center;
    padding: 1rem 0;
  }

  .news-sidebar_widget-image--placeholder {
    background-color: #f3f4f6;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #9ca3af;
  }

  .news-sidebar_widget-category {
    display: block;
    font-size: 0.75rem;
    color: #0ea5e9;
    font-weight: 500;
    margin-top: 0.25rem;
  }
</style>
