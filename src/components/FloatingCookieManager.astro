---
// Floating Cookie Manager Button
// Provides easy access to cookie settings after the banner is dismissed
---

<button
  id="floating-cookie-manager"
  class="floating-cookie-btn"
  title="Gestionar cookies"
>
  üç™
</button>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function () {
    const floatingBtn = document.getElementById('floating-cookie-manager');

    if (floatingBtn) {
      // Show floating button only if user has already made a cookie choice
      const hasConsent = localStorage.getItem('cookie-consent');
      if (hasConsent) {
        floatingBtn.style.display = 'block';
      }

      // Handle click to open cookie settings
      floatingBtn.addEventListener('click', function () {
        const modal = document.getElementById('cookie-settings-modal');
        if (modal) {
          modal.style.display = 'flex';
          // Set current preferences
          const analyticsConsent =
            localStorage.getItem('analytics-consent') === 'true';
          const analyticsCheckbox =
            document.getElementById('analytics-cookies');
          if (analyticsCheckbox) {
            analyticsCheckbox.checked = analyticsConsent;
          }
        }
      });
    }
  });

  // Listen for cookie consent changes to show/hide the floating button
  window.addEventListener('storage', function (e) {
    if (e.key === 'cookie-consent') {
      const floatingBtn = document.getElementById('floating-cookie-manager');
      if (floatingBtn && e.newValue) {
        floatingBtn.style.display = 'block';
      }
    }
  });
</script>

<style>
  .floating-cookie-btn {
    position: fixed;
    bottom: 20px;
    left: 20px;
    width: 50px;
    height: 50px;
    background: #2c3e50;
    color: white;
    border: none;
    border-radius: 50%;
    font-size: 1.2rem;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    z-index: 9998;
    display: none; /* Hidden by default, shown via JavaScript */
    transition: all 0.3s ease;
    opacity: 0.8;
  }

  .floating-cookie-btn:hover {
    background: #34495e;
    transform: scale(1.1);
    opacity: 1;
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
  }

  .floating-cookie-btn:active {
    transform: scale(0.95);
  }

  /* Hide on mobile to avoid interference with mobile navigation */
  @media (max-width: 768px) {
    .floating-cookie-btn {
      display: none !important;
    }
  }

  /* Adjust position when cookie banner is visible */
  body:has(#cookie-banner[style*='block']) .floating-cookie-btn {
    bottom: 120px;
  }
</style>
